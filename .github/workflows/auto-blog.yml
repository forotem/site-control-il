name: Auto Blog Creation

on:
  # 专抓   砖注 02:00 UTC (04:00 砖专)
  schedule:
    - cron: '0 2 */2 * *'
  
  # 驻砖专转 专抓 转
  workflow_dispatch:

jobs:
  create-blog:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # 爪专  注砖转 push
    
    steps:
      - name:  Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
      
      - name:  Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name:  Install root dependencies
        run: npm ci
      
      - name:  Install automation dependencies
        run: |
          cd automation
          npm install
      
      - name:  Configure Git
        run: |
          git config user.name "Auto Blog Bot"
          git config user.email "bot@site-control-il.com"
      
      - name:  Run auto scheduler
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          AUTO_GENERATE_IMAGES: 'true'
        run: |
          cd automation
          node auto-scheduler.js
      
      - name:  Push changes
        run: |
          # 拽  砖 砖
          if git diff --quiet && git diff --staged --quiet; then
            echo " 砖 commit"
          else
            echo "砖 砖, 注砖 push..."
            git push
          fi
